<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AlgoSphere – Reports</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">
<div class="container py-4">
  <h4 class="mb-3">Trade Reports ({{ period|capitalize }})</h4>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="alert alert-{{ category }} mb-3">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Date filter -->
  <form class="row g-2 mb-3" method="get" action="{{ url_for('dash.reports') }}">
    <div class="col-auto">
      <label class="form-label mb-0 small">From</label>
      <input type="date" name="from" class="form-control form-control-sm"
             value="{{ start_date.strftime('%Y-%m-%d') }}">
    </div>
    <div class="col-auto">
      <label class="form-label mb-0 small">To</label>
      <input type="date" name="to" class="form-control form-control-sm"
             value="{{ end_date.strftime('%Y-%m-%d') }}">
    </div>
    <div class="col-auto align-self-end">
      <button class="btn btn-sm btn-primary" type="submit">Filter</button>
    </div>
  </form>

  <!-- Summary -->
  <div class="mb-3">
    <strong>Total P&L:</strong>
    <span class="{{ 'text-success' if total_pnl >= 0 else 'text-danger' }}">
      ₹{{ '%.2f'|format(total_pnl) }}
    </span>
    <span class="ms-3">
      <strong>Win rate:</strong> {{ '%.1f'|format(win_rate) }}%
    </span>
  </div>

  <!-- Trades table -->
  <table class="table table-dark table-striped table-sm align-middle">
    <thead>
      <tr>
        <th>Date/Time</th>
        <th>Strategy</th>
        <th>Symbol</th>
        <th>Side</th>
        <th>Qty</th>
        <th>Entry</th>
        <th>Exit</th>
        <th>P&L (₹)</th>
      </tr>
    </thead>
    <tbody>
      {% for t in trades %}
      <tr>
        <td>{{ t.closed_at.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ t.strategy_name }}</td>
        <td>{{ t.symbol }}</td>
        <td>{{ t.side }}</td>
        <td>{{ t.qty }}</td>
        <td>{{ '%.2f'|format(t.entry_price) }}</td>
        <td>{{ '%.2f'|format(t.exit_price) }}</td>
        <td class="{{ 'text-success' if t.pnl >= 0 else 'text-danger' }}">
          {{ '%.2f'|format(t.pnl) }}
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="8" class="text-center text-muted">
          No trades found for this period.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <a href="{{ url_for('dash.dashboard') }}" class="btn btn-secondary btn-sm mt-2">
    Back to Dashboard
  </a>
</div>
</body>
</html>
